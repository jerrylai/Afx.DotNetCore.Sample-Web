<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>登录</title>
    <link href="css/base.css?v=1.0.0.0" rel="stylesheet" />
    <link href="lib/jquery-easyui-1.5.2/themes/bootstrap/easyui.css" rel="stylesheet" />
    <link href="lib/jquery-easyui-1.5.2/themes/icon.css" rel="stylesheet" />
    <link href="lib/jquery-easyui-1.5.2/themes/color.css" rel="stylesheet" />
    <script src="js/jquery.min-1.11.3.js"></script>
    <script src="lib/jquery-easyui-1.5.2/jquery.easyui.min.js"></script>
    <script src="lib/jquery-easyui-1.5.2/locale/easyui-lang-zh_CN.js"></script>
    <script src="js/json.js?v=1.0.0.0"></script>
    <script src="js/base.js?v=1.0.0.0"></script>
    <script src="js/md5.min.js"></script>
    <script type="text/javascript">
        var mainPage = '/main.html?v=1.0.0.0';
        $(document).ready(function () {
            var $doc = $(document);
            var $win = $(window);

            var $tr_head = $('#tr_head');
            var $div_login = $('#div_login');
            var $loadWin = $('#loadWin');
            $win.ajaxStart(function () {
                $loadWin.window({ width: 60, height: 60 }).window('open');
            });

            $win.ajaxStop(function () {
                $loadWin.window('close');
            });

            function setPosition(num) {
                function _setPosition() {
                    var height = $win.height();
                    var login_height = $div_login.height();
                    if (height > login_height) {
                        $tr_head.height((height - login_height) * 0.3);
                    }
                }
                if (num >= 50) {
                    window.setTimeout(_setPosition, num);
                }
                else {
                    _setPosition();
                }
            }

            window.onresize = function () { setPosition(50); };
            window.onchange = function () { setPosition(50); };

            function isLogin() {
                $.getPrivate('/User/IsLogin', function (data) {
                    if (data.Status == 0 && data.Data == true) {
                        var returnUrl = $.getUrlParam(window.location.href, "returnUrl");
                        if (returnUrl) window.location.href = returnUrl;
                        window.location.href = '/main.html';
                    }
                });
            }

            var accountCookieName = 'account';
            var pwdCookieName = 'password';
            var $textbox_Account = $('#textbox_Account');
            var $textbox_Password = $('#textbox_Password');
            function setLogin() {
                var account = $.cookie(accountCookieName);
                if (account) {
                    $textbox_Account.textbox('setValue', account);
                    var pwd = $.cookie(pwdCookieName);
                    if (pwd) {
                        $textbox_Password.textbox('setValue', pwd);
                    }
                    document.getElementById('checkbox_Remember').checked = true;
                }
            }

            $textbox_Account.textbox('textbox').bind('keydown', function (e) {
                if (e.keyCode == 13) {
                    $textbox_Password.textbox('textbox').focus();
                }
            });

            $textbox_Password.textbox('textbox').keydown(function (e) {
                if (e.keyCode == 13) {
                    login();
                }
            });

            function login() {
                if ($('#form_login').form('enableValidation').form('validate')) {
                    var user = {};
                    user.Account = $textbox_Account.textbox('getValue');
                    var pwd = $textbox_Password.textbox('getValue');
                    user.Random = Math.random();
                    var oldPwd = $.cookie(pwdCookieName);
                    if (pwd != oldPwd) {
                        pwd = md5(pwd).toUpperCase();
                    }
                    user.Password = md5(pwd + "|" + user.Random).toUpperCase();
                    $.postPublic('/User/Login', user, function (data) {
                        if (data.Status == 0 && data.Data == true) {
                            var re = document.getElementById('checkbox_Remember');
                            if (re.checked) {
                                $.cookie(accountCookieName, user.Account, { expires: 365 });
                                $.cookie(pwdCookieName, pwd, { expires: 365 });
                            }
                            else {
                                $.cookie(accountCookieName, null);
                                $.cookie(pwdCookieName, null);
                            }
                            window.location.href = mainPage;
                        }
                        else {
                            $.messager.alert('提示', '账号或密码错误！', 'warning');
                        }
                    });
                }
            }

            $('#linkbutton_login').linkbutton({
                onClick: function () {
                    login();
                }
            });

            setPosition();
            setPosition(50);
            setLogin();
            isLogin();
        });
    </script>
</head>
<body style="background-color:#2d3e50">
    <table style="width:100%; height:100%">
        <tr id="tr_head" style="width:100%; height:150px">
            <td style="width:50%"></td>
            <td></td>
            <td style="width:50%"></td>
        </tr>
        <tr>
            <td></td>
            <td>
                <form id="form_login" class="easyui-form" data-options="novalidate:true" style="overflow:hidden">
                    <div id="div_login" class="easyui-panel" title="登录" data-options="noheader:true" style="width:420px;padding:20px 40px 30px 40px;overflow:hidden">
                        <div style="margin-bottom:20px; height:40px;line-height:40px;font-size:24px;font:bold;text-align:center">
                            用户认证中心
                        </div>
                            <div style="margin-bottom:10px;height:40px;line-height:40px">
                                <label style="font-size:16px;float:left;width:60px">账号：</label>
                                <input id="textbox_Account" name="Account" type="text" class="easyui-textbox" style="width:250px;height:40px;padding:12px"
                                       data-options="prompt:'输入账号',required:true,validType:['account','length[1,30]']">
                            </div>
                            <div style="margin-bottom:20px;height:40px;line-height:40px">
                                <label style="font-size:16px;float:left;width:60px">密码：</label>
                                <input id="textbox_Password" name="Password" type="password" class="easyui-textbox" style="width:250px;height:40px;padding:12px"
                                       data-options="prompt:'输入密码',required:true">
                            </div>
                            <div style="margin-bottom:20px;padding-left:60px;">
                                    <input id="checkbox_Remember" name="Remember" value="1" type="checkbox" style="vertical-align:middle;">
                                    <label style="margin-left:3px;margin-top:0px;font-size:12px">记住密码</label>
                            </div>
                            <div style=";padding-left:60px">
                                <a id="linkbutton_login" class="easyui-linkbutton c2" style="padding:5px 0px;width:250px;">
                                    <span style="font-size:14px;">登 录</span>
                                </a>
                            </div>
                        </div>

                    <div id="loadWin" class="easyui-window" style="width:60px;height:60px;overflow:hidden" data-options="modal:true,border:false,resizable:false,closed:true,noheader:true">
                        <img width="60" height="60" src="images/loading.gif" />
                    </div>
                </form>
            </td>
            <td></td>
        </tr>
    </table>
</body>
</html>