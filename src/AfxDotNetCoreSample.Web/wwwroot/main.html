<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>用户认证中心</title>
    <link href="css/base.css?v=1.0.0.0" rel="stylesheet" />
    <link href="lib/jquery-easyui-1.5.2/themes/bootstrap/easyui.css" rel="stylesheet" />
    <link href="lib/jquery-easyui-1.5.2/themes/icon.css" rel="stylesheet" />
    <link href="lib/jquery-easyui-1.5.2/themes/color.css" rel="stylesheet" />
    <script src="js/jquery.min-1.11.3.js"></script>
    <script src="lib/jquery-easyui-1.5.2/jquery.easyui.min.js"></script>
    <script src="lib/jquery-easyui-1.5.2/locale/easyui-lang-zh_CN.js"></script>
    <script src="js/json.js?v=1.0.0.0"></script>
    <script src="js/base.js?v=1.0.0.0"></script>
    <script src="js/vue.min.js"></script>
    <style type="text/css">
        .panel-title {
            font-size: 14px;
        }

        .tree-title {
            font-size: 14px;
            height: 26px;
            line-height: 26px;
        }

            .tree-title a {
                text-decoration: none;
            }

        .tree-node {
            height: 26px;
        }

        .panel-group {
            max-height: 770px;
            overflow: auto;
        }
    </style>
    <script type="text/javascript">
        var loginPage = '/index.html?v=1.0.0.0';
        var currentUrl = null;
        function loadPage(obj) {
            if (!obj) {
                obj = currentUrl;
                if (!obj) obj = { url: '/html/home.html', name: '首页' };
            }
            if (obj && obj.url) {
                $('#main_content').panel({ title: obj.name, href: obj.url });
                currentUrl = obj;
            }
        }
        $(document).ready(function () {
            var $doc = $(document);
            var $win = $(window);
            var $loadWin = $('#loadWin');
            $win.ajaxStart(function () {
                $loadWin.window({ width: 60, height: 60 }).window('open');
            });

            $win.ajaxStop(function () {
                $loadWin.window('close');
            });

            $('#lbLogout').click(function () {
                $.getPrivate('/User/Logout', function (data) {
                    window.location.href = loginPage;
                });
            });

            $('#lbUserPwd').click(function () {
                loadPage({ url: '/html/EditPwd.html', name: '修改密码' });
            });

            var $ul_Menu = $('#ul_Menu').tree({
                onClick: function (node) {
                    if ($.isArray(node.children)) {
                        $ul_Menu.tree('toggle', node.target);
                    }
                    else if (node.url) {
                        loadPage({ url: node.url, name: node.text });
                    }
                }
            });

            function getMenu() {
                $.getPrivate('/WebMenu/GetUserMenu', function (data) {
                    if (data.status == 0 && $.isArray(data.data)) {
                        $ul_Menu.tree('loadData', data.data);
                        loadPage();
                    }
                });
            }

            function getUserName() {
                $.getPrivate('/User/GetName', function (data) {
                    if (data.Status == 0) {
                        $('#lbUserName').text(data.Data);
                    }
                });
            }
            getMenu();
            function isLogin() {
                $.getPrivate('/User/IsLogin', function (data) {
                    if (data.Status == 0 && data.Data) {
                        getUserName();
                        getMenu();
                    }
                    else {
                        $.messager.alert('提示', '登录已超时，请重新登录！', 'warning', function () {
                            // window.location.href = loginPage;
                            getMenu();
                        });
                    }
                });
            }

            isLogin();
        });
    </script>
</head>
<body class="easyui-layout">
    <div data-options="region:'north',border:false" style="height:60px;background-color:#2d3e50;color:white;padding:5px;overflow:hidden;">
        <div style="margin:5px 0 0 5px;float:left">
            <a style="font-size:28px;color:white;cursor:pointer" onclick="loadPage({ url: '/html/home.html', name: '首页' });">UserPlatform</a>
        </div>
        <div style ="margin-right:8px;float:right;">
            <a id="lbUserName" style="margin-left:10px;font-size:12px;color:white;cursor:pointer;text-decoration:underline;">admin</a>
            <a id="lbUserPwd" style="margin-left:8px;font-size:12px;color:white;cursor:pointer;text-decoration:underline;">修改密码</a>
            <a id="lbLogout" style="margin-left:8px;font-size:12px;color:white;cursor:pointer;text-decoration:underline">退出</a>
        </div>
    </div>

    <div data-options="region:'west',split:true,title:'菜单'" style="width:280px;padding:0px;">
        <ul id="ul_Menu" class="easyui-tree" data-options="animate:true,lines:false" style="padding-top:10px;padding-left:10px"></ul>
    </div>

        <!--<div data-options="region:'south',border:false" style="height:30px;background-color:#2d3e50;color:white;overflow:hidden">
            <div style="text-align:center;padding-top:8px;font-size:12px">版权所有 © 2017-2027 深圳市XX科技有限公司</div>
        </div>-->

    <div id="main_content" data-options="region:'center',title:'首页',loadingMessage:'',tools:[{iconCls:'icon-reload',handler:function(){loadPage();}}]" style="overflow:scroll;padding:10px 0 0 10px">
        <div id="app">
            {{ message }}
        </div>
        <script type="text/javascript">
            var app = new Vue({
                el: '#app',
                data: {
                    message: 'Hello Vue!'
                }
            });
            
        </script>

    </div>

        <div id="loadWin" class="easyui-window" style="width:60px;height:60px;overflow:hidden" data-options="modal:true,border:false,resizable:false,closed:true,noheader:true">
            <img width="60" height="60" src="images/loading.gif" />
        </div>
</body>
</html>